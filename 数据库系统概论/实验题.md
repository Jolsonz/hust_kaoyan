数据库第一次实验

```sql
//创建表film
create table FILM (
FID int, 
FNAME char(30), 
FTYPE char(10), 
DNAME char(30), 
length int, 
IS3D char(1),
GRADE int,
PRIMARY KEY(FID),
check( (GRADE BETWEEN 0 AND 100) or (GRADE is NULL))
);

//创建表actor
create table ACTOR(ACTID int, ANAME char(30), SEX char(2), BYEAR int, PRIMARY KEY(ACTID));

//创建表actin
CREATE TABLE ACTIN(ACTID int, FID int, ISLEADING char(1), GRADE int,
FOREIGN key(ACTID) REFERENCES ACTOR(ACTID),
FOREIGN KEY(FID) REFERENCES FILM(FID),
check (ISLEADING = 'Y' or ISLEADING = 'N' or ISLEADING is NULL),
check ( (GRADE >= 0 AND GRADE <= 100 ) OR GRADE is NULL) 
);

//创建表theater
CREATE TABLE THEATER(TID int, TNAME char(20), TAREA char(20), ADDRESS char(30),
PRIMARY KEY (TID)
);

//创建表show
CREATE TABLE SHOW_T(FID int, TID int, PRICE int, YEAR int , MONTH int,
FOREIGN KEY(FID) REFERENCES FILM(FID),
FOREIGN KEY(TID) REFERENCES THEATER(TID)
);

1)查询“后来的我们”这部电影在洪山区各家影院的2017年的上映情况，并按照上映月份的降序排列；
SELECT *
FROM SHOW_T
WHERE SHOW_T.`YEAR` = 2017 AND SHOW_T.FID = ANY(
SELECT FID
FROM FILM
WHERE FILM.FNAME = '后来的我们')
AND SHOW_T.TID = ANY(
SELECT TID
FROM THEATER
WHERE THEATER.TAREA = '洪山区')
ORDER BY SHOW_T.`MONTH` ASC;

2)查询所有没有参演演员信息的电影的基本信息； 
SELECT *
FROM FILM
WHERE FILM.FID NOT IN(
SELECT FID
FROM ACTIN
GROUP BY ACTIN.FID
HAVING COUNT(DISTINCT ACTID)>0);

3)查询所有用户评分低于80分或者高于89分的电影编号、电影名称、导演姓名及其用户评分，要求where子句中只能有一个条件表达式；
SELECT FID,FNAME,DNAME,GRADE
FROM FILM
WHERE GRADE BETWEEN 80 AND 89;WHFWHWTSH

4)查询执导过动作片或惊悚片的导演的姓名，要求where子句中只能有一个条件表达式；
SELECT DNAME
FROM FILM 
WHERE FILM.FTYPE = '惊悚'
UNION
SELECT DNAME
FROM FILM
WHERE FILM.FTYPE = '动作';

5)查询所有“巴霍巴利王”系列的电影的编号、电影名称、上映电影院名称及其上映年月； 
SELECT FILM.FID,FNAME,TNAME,YEAR,MONTH
FROM (FILM JOIN SHOW_T ON FILM.FID = SHOW_T.FID) JOIN 	THEATER ON SHOW_T.TID = THEATER.TID
WHERE FILM.FNAME LIKE "巴霍巴利王%";

6)查询每部电影的上映总次数；
SELECT FID,COUNT(FID)
FROM SHOW_T 
GROUP BY FID
ORDER BY COUNT(FID);

7)查询每个演员担任主角的电影中的平均用户评分； 
SELECT ACTID,AVG(GRADE)
FROM ACTIN
WHERE ISLEADING = 'Y'
GROUP BY ACTID;

8)查询每个导演所执导的全部影片的最低和最高用户评分；
SELECT DNAME,MIN(GRADE),MAX(GRADE)
FROM FILM
GROUP BY DNAME;

9)查询至少执导过2部电影的导演及其执导电影的数量；
SELECT DNAME,COUNT(*)
FROM FILM
GROUP BY DNAME
HAVING COUNT(*) >=2; 

10)查询至少有2部电影的用户评分超过80分的导演姓名及其执导过的影片数量、平均用户评分；
SELECT DNAME,COUNT(*),AVG(GRADE)
FROM FILM
WHERE GRADE > 80
GROUP BY DNAME
HAVING COUNT(*) >=2; 

11)查询至少执导过2部电影的导演以及跟这些导演合作过的演员的编号及姓名；
SELECT ACTOR.ACTID, ACTOR.ANAME
FROM ACTIN JOIN ACTOR ON ACTIN.ACTID = ACTOR.ACTID
WHERE FID IN
(SELECT FID 
FROM FILM 
WHERE DNAME IN
(SELECT DNAME
FROM FILM
GROUP BY FILM.DNAME
HAVING COUNT(*) >=2)
);

12)查询所有直到2017年仍未上映的电影编号、电影名称、导演姓名；
SELECT DISTINCT A.FID, A.FNAME, A.DNAME
FROM FILM A JOIN SHOW_T ON A.FID = SHOW_T.FID
WHERE SHOW_T.`YEAR` > 2017;

13)查询在各家电影院均上映过的电影编号；
SELECT FID 
FROM FILM
WHERE NOT EXISTS
(
SELECT * 
FROM THEATER
WHERE NOT EXISTS
(
SELECT *
FROM SHOW_T
WHERE THEATER.TID = SHOW_T.TID AND FILM.FID = SHOW_T.FID
)
);

14)查询用户评分超过90分的电影的最早上映年月及相应的上映影院编号；
SELECT TID 
FROM SHOW_T,
(SELECT SHOW_T.FID,SHOW_T.`YEAR`,MIN(SHOW_T.`MONTH`)
FROM SHOW_T,(SELECT SHOW_T.FID,MIN(SHOW_T.`YEAR`)
							FROM SHOW_T join FILM ON SHOW_T.FID = 	FILM.FID
							WHERE FILM.GRADE > 90
							GROUP BY FID)
							AS TB(fid,y)
WHERE SHOW_T.FID = TB.fid AND SHOW_T.`YEAR`= TB.y
GROUP BY FID,`YEAR`) as tb2(fid2,year2,month2)
WHERE SHOW_T.FID = tb2.fid2 and SHOW_T.`YEAR` = tb2.year2 and 	SHOW_T.`MONTH` = tb2.month2;

15)查询在同一年月上映过‘30187395’号和‘26942631’号电影的影院编号；
SELECT TID,SHOW_T.`YEAR`,SHOW_T.`MONTH`
from SHOW_T
where FID = 30187395
INTERSECT
SELECT TID,SHOW_T.`YEAR`,SHOW_T.`MONTH`
FROM SHOW_T
WHERE FID = 26942631;

16)查询所有从未参演过用户评分85分以下电影的演员的编号、姓名；
SELECT ACTOR.ACTID,ACTOR.ANAME
FROM ACTIN JOIN ACTOR ON ACTIN.ACTID = ACTOR.ACTID
WHERE NOT EXISTS
(SELECT *
FROM FILM
WHERE GRADE < 85 AND ACTIN.FID = FID);

17)查询所有的演员的编号、姓名及其参演过的电影名称，要求即使该演员未参演过任何电影也要能够输出其编号、姓名；
SELECT ACTOR.ACTID, ACTOR.ANAME, FNAME
FROM (ACTOR JOIN ACTIN ON ACTOR.ACTID = ACTIN.ACTID) JOIN 	FILM ON ACTIN.FID	 = FILM.FID
ORDER BY ACTOR.ACTID;

18)查询所有上映超过3次但没有用户评分的电影编号、名称。
SELECT FID, FNAME
FROM FILM 
WHERE GRADE IS NULL AND FID IN (
SELECT FID 
FROM SHOW_T
GROUP BY FID
HAVING COUNT(*) > 3);
```



